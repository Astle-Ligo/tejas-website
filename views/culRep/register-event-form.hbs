<section
    class="py-20 px-6 bg-light-beige text-dark-bistre flex justify-center items-center min-h-screen font-handwritten">
    <div class="bg-white p-8 shadow-lg rounded-lg max-w-2xl w-full">
        <h2 class="text-3xl font-bold text-dark-coffee text-center mb-6 font-handwritten">
            Register for {{event.eventName}}
        </h2>
        <form action="/culRep/register-event/{{event._id}}" method="post" class="space-y-4 font-handwritten">
            <input type="hidden" name="eventId" value="{{event._id}}">

            <!-- Individual Registration Fields -->
            <div id="individualFields" class="form-section">
                <label class="block font-semibold font-handwritten">Participant Name</label>
                <input type="text" name="participantName" class="input-field font-handwritten"
                    placeholder="Enter your name">

                <label class="block font-semibold font-handwritten">Registration Number</label>
                <input type="text" name="regNum" class="input-field font-handwritten"
                    placeholder="Enter registration number">

                <label class="block font-semibold font-handwritten">Phone Number</label>
                <input type="tel" name="phone" class="input-field font-handwritten" placeholder="Enter phone number">
            </div>

            <!-- Group Registration Fields -->
            <div id="groupFields" class="hidden form-section">
                <label class="block font-semibold font-handwritten">Team Name</label>
                <input type="text" name="teamName" class="input-field font-handwritten" placeholder="Enter team name">

                <label class="block font-semibold font-handwritten">Team Contact Number</label>
                <input type="tel" name="teamPhone" class="input-field font-handwritten"
                    placeholder="Enter team contact number">

                <label class="block font-semibold font-handwritten">Alternate Phone Number</label>
                <input type="tel" name="altPhone" class="input-field font-handwritten"
                    placeholder="Enter alternate contact number">

                <!-- Team Members Section -->
                <div id="teamMembers" class="mt-4">
                    <label class="block font-semibold font-handwritten">Team Members</label>
                </div>

                <!-- Add Team Member Button -->
                <button type="button" id="addMemberBtn" class="btn-primary mt-4 font-handwritten"
                    onclick="addTeamMember()">
                    + Add Member
                </button>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-submit w-full font-handwritten">Register</button>
        </form>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const eventStrength = "{{event.eventStrength}}";
        let minParticipants = "{{event.minParticipants}}" ? parseInt("{{event.minParticipants}}", 10) || null : null;
        const maxParticipants = parseInt("{{event.maxParticipants}}", 10) || 10;
        const teamMembersDiv = document.getElementById("teamMembers");
        const addMemberBtn = document.getElementById("addMemberBtn");
        const form = document.querySelector("form");

        if (eventStrength === "group") {
            document.getElementById("individualFields").classList.add("hidden");
            document.getElementById("groupFields").classList.remove("hidden");

            let initialParticipants = minParticipants !== null ? minParticipants : maxParticipants;
            for (let i = 0; i < initialParticipants; i++) {
                addTeamMember(false);
            }
        }

        checkAddMemberButton();

        function addTeamMember(allowDelete = true) {
            let currentMembers = document.querySelectorAll(".team-member").length;
            if (currentMembers >= maxParticipants) return;

            let newMemberDiv = document.createElement("div");
            newMemberDiv.classList.add("team-member", "flex", "gap-2", "items-center", "opacity-0", "transition-opacity", "duration-300");

            let inputWrapper = document.createElement("div");
            inputWrapper.classList.add("flex", "gap-2", "w-full");

            let nameInput = document.createElement("input");
            nameInput.type = "text";
            nameInput.name = "teamMembers[]";
            nameInput.className = "input-field font-handwritten";
            nameInput.placeholder = "Member Name";
            nameInput.required = true;

            let regNumInput = document.createElement("input");
            regNumInput.type = "text";
            regNumInput.name = "teamRegNums[]";
            regNumInput.className = "input-field font-handwritten";
            regNumInput.placeholder = "Reg No.";
            regNumInput.required = true;

            inputWrapper.appendChild(nameInput);
            inputWrapper.appendChild(regNumInput);

            if (allowDelete) {
                let deleteBtn = document.createElement("button");
                deleteBtn.type = "button";
                deleteBtn.className = "btn-danger remove-member font-handwritten";
                deleteBtn.innerText = "Delete";
                deleteBtn.onclick = function () {
                    removeTeamMember(newMemberDiv);
                };

                let deleteBtnWrapper = document.createElement("div");
                deleteBtnWrapper.classList.add("w-[100px]");
                deleteBtnWrapper.appendChild(deleteBtn);
                newMemberDiv.appendChild(deleteBtnWrapper);
            } else {
                let emptySpace = document.createElement("div");
                emptySpace.classList.add("w-[100px]");
                newMemberDiv.appendChild(emptySpace);
            }

            newMemberDiv.insertBefore(inputWrapper, newMemberDiv.firstChild);
            teamMembersDiv.appendChild(newMemberDiv);

            setTimeout(() => newMemberDiv.classList.remove("opacity-0"), 10);

            checkAddMemberButton();
        }

        function removeTeamMember(memberDiv) {
            memberDiv.classList.add("opacity-0");
            setTimeout(() => {
                memberDiv.remove();
                checkAddMemberButton();
            }, 300);
        }

        function checkAddMemberButton() {
            let currentMembers = document.querySelectorAll(".team-member").length;
            addMemberBtn.style.display = currentMembers >= maxParticipants ? "none" : "block";

            let memberElements = document.querySelectorAll(".team-member");
            memberElements.forEach((member, index) => {
                let deleteBtn = member.querySelector(".remove-member");
                if (deleteBtn) {
                    deleteBtn.style.display = index > (minParticipants || 0) ? "inline-block" : "none";
                }
            });

            addMemberBtn.classList.add("mt-4", "block");
        }

        form.addEventListener("submit", function (event) {
            let currentMembers = document.querySelectorAll(".team-member").length;

            if (minParticipants !== null && currentMembers < minParticipants) {
                alert(`At least ${minParticipants} participants are required to register.`);
                event.preventDefault();
            }
        });

        window.addTeamMember = addTeamMember;
        window.removeTeamMember = removeTeamMember;
    });

</script>