<section class="registration-section">
    <div class="container">
        <h2 class="text-center">Register for {{event.eventName}}</h2>

        <form action="/culRep/register-event/{{event._id}}" method="post">
            <input type="hidden" name="eventId" value="{{event._id}}">

            <!-- Event Details (Read-only) -->
            <label for="eventName">Event Name</label>
            <input type="text" id="eventName" class="form-control" value="{{event.eventName}}" readonly>

            <label for="eventSubName">Event Sub Name</label>
            <input type="text" id="eventSubName" class="form-control" value="{{event.eventSubName}}" readonly>

            <label for="eventStrength">Participation Type</label>
            <input type="text" id="eventStrength" class="form-control" value="{{event.eventStrength}}" readonly>

            <label for="Class">Class</label>
            <input type="text" id="Class" class="form-control" value="{{culRepUser.class}}" readonly>

            <!-- Individual Registration Fields -->
            <div id="individualFields">
                <label for="participantName">Participant Name</label>
                <input type="text" name="participantName" id="participantName" class="form-control">

                <label for="regNum">Registration Number</label>
                <input type="text" name="regNum" id="regNum" class="form-control">

                <label for="email">Email</label>
                <input type="email" name="email" id="email" class="form-control">

                <label for="phone">Phone Number</label>
                <input type="tel" name="phone" id="phone" class="form-control">
            </div>

            <!-- Group Registration Fields -->
            <div id="groupFields" style="display: none;">
                <label for="teamName">Team Name</label>
                <input type="text" name="teamName" id="teamName" class="form-control">

                <label for="phone">Team Contact Number</label>
                <input type="tel" name="teamPhone" id="phone" class="form-control">

                <label for="altPhone">Alternate Phone Number</label>
                <input type="tel" name="altPhone" id="altPhone" class="form-control">

                <div id="teamMembers">
                    <label>Team Members</label>
                </div>

                <input type="hidden" name="teamMembers" id="hiddenTeamMembers">
                <input type="hidden" name="teamRegNums" id="hiddenTeamRegNums">

                <button type="button" class="btn btn-primary mt-2" id="addMemberBtn" onclick="addTeamMember()">+ Add
                    Member</button>
            </div>

            <button class="btn btn-success mt-3" type="submit">Register</button>
        </form>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const eventStrength = "{{event.eventStrength}}"; // "individual" or "group"
        const minParticipants = parseInt("{{event.minParticipants}}") || 1;
        const maxParticipants = parseInt("{{event.maxParticipants}}") || 10;
        const teamMembersDiv = document.getElementById("teamMembers");
        const addMemberBtn = document.getElementById("addMemberBtn");

        function setRequiredFields(fields, isRequired) {
            fields.forEach(field => {
                if (isRequired) {
                    field.setAttribute("required", "required");
                } else {
                    field.removeAttribute("required");
                }
            });
        }

        if (eventStrength === "group") {
            document.getElementById("individualFields").style.display = "none";
            document.getElementById("groupFields").style.display = "block";

            // Remove required from individual fields
            setRequiredFields(document.querySelectorAll("#individualFields input"), false);

            // Add required for group fields
            setRequiredFields(document.querySelectorAll("#groupFields input"), true);

            // Clear previous members
            teamMembersDiv.innerHTML = '';

            // Add the required minimum participants dynamically
            for (let i = 0; i < minParticipants; i++) {
                let newMemberDiv = document.createElement("div");
                newMemberDiv.classList.add("team-member", "mt-2");
                newMemberDiv.innerHTML = `
                    <input type="text" name="teamMembers[]" class="form-control mt-2" placeholder="Member Name">
                    <input type="text" name="teamRegNums[]" class="form-control mt-2" placeholder="Reg No.">
                `;
                teamMembersDiv.appendChild(newMemberDiv);
            }

            // Add required for team members
            setRequiredFields(document.querySelectorAll("#teamMembers input"), true);

            // Hide "Add Member" button if minParticipants equals maxParticipants
            if (minParticipants >= maxParticipants) {
                addMemberBtn.style.display = "none";
            }
        } else {
            document.getElementById("individualFields").style.display = "block";
            document.getElementById("groupFields").style.display = "none";

            // Add required to individual fields
            setRequiredFields(document.querySelectorAll("#individualFields input"), true);

            // Remove required from group fields
            setRequiredFields(document.querySelectorAll("#groupFields input"), false);
        }
    });

    function addTeamMember() {
        const maxParticipants = parseInt("{{event.maxParticipants}}") || 10;
        const teamMembersDiv = document.getElementById("teamMembers");
        const addMemberBtn = document.getElementById("addMemberBtn");
        const currentMembers = teamMembersDiv.getElementsByClassName("team-member").length;

        if (currentMembers < maxParticipants) {
            let newMemberDiv = document.createElement("div");
            newMemberDiv.classList.add("team-member", "mt-2");
            newMemberDiv.innerHTML = `
                <input type="text" name="teamMembers[]" class="form-control mt-2" placeholder="Member Name">
                <input type="text" name="teamRegNums[]" class="form-control mt-2" placeholder="Reg No.">
                <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeTeamMember(this)">Delete</button>
            `;
            teamMembersDiv.appendChild(newMemberDiv);

            // Add required for the newly added fields
            setRequiredFields(newMemberDiv.querySelectorAll("input"), true);
        }

        if (currentMembers + 1 >= maxParticipants) {
            addMemberBtn.style.display = "none";
        }
    }

    function removeTeamMember(button) {
        const teamMembersDiv = document.getElementById("teamMembers");
        const addMemberBtn = document.getElementById("addMemberBtn");

        button.parentElement.remove();
        addMemberBtn.style.display = "block";
    }

    function setRequiredFields(fields, isRequired) {
        fields.forEach(field => {
            if (isRequired) {
                field.setAttribute("required", "required");
            } else {
                field.removeAttribute("required");
            }
        });
    }
</script>